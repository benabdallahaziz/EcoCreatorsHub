<form method="post" class="needs-validation" novalidate>
    {# Token CSRF #}
    <input type="hidden" name="_token" value="{{ csrf_token('user_create') }}">

    <!-- USERNAME -->
    <div class="mb-3">
        <label class="form-label">Nom d'utilisateur</label>
        <input type="text"
               name="username"
               class="form-control"
               required
               minlength="3"
               pattern="^[a-zA-Z0-9_]+$"
               placeholder="ex: aziz123">
        <div class="invalid-feedback">
            Minimum 3 caractères (lettres, chiffres ou _).
        </div>
    </div>

    <!-- EMAIL -->
    <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email"
               name="email"
               class="form-control"
               required
               placeholder="ex: user@email.com">
        <div class="invalid-feedback">
            Veuillez entrer un email valide.
        </div>
    </div>

    <!-- PASSWORD -->
    <div class="mb-3">
        <label class="form-label">Mot de passe</label>
        <input type="password"
               name="password"
               id="password"
               class="form-control"
               required
               minlength="8"
               pattern="^(?=.*[A-Za-z])(?=.*\d).+$"
               placeholder="Min 8 caractères, lettres + chiffres">
        <div class="invalid-feedback">
            Minimum 8 caractères avec au moins une lettre et un chiffre.
        </div>
    </div>

    <!-- CONFIRM PASSWORD -->
    <div class="mb-3">
        <label class="form-label">Confirmer mot de passe</label>
        <input type="password"
               name="confirm_password"
               id="confirm_password"
               class="form-control"
               required>
        <div class="invalid-feedback" id="confirmPasswordFeedback">
            Les mots de passe ne correspondent pas.
        </div>
    </div>

    <!-- ROLE (DEFAULT USER) -->
    <div class="mb-3">
        <label class="form-label">Rôle</label>
        <select name="role" class="form-select" required>
            <option value="ROLE_USER" selected>Utilisateur</option>
            <option value="ROLE_ADMIN">Administrateur</option>
        </select>
    </div>

    <!-- STATUS (DEFAULT ACTIVE) -->
    <div class="mb-4">
        <label class="form-label">Statut</label>
        <select name="isActive" class="form-select" required>
            <option value="1" selected>Actif</option>
            <option value="0">Inactif</option>
        </select>
    </div>

    <button class="btn btn-primary w-100">
        <i class="fas fa-save me-1"></i>Créer l'utilisateur
    </button>
</form>

{# Script pour vérifier la correspondance des mots de passe côté front #}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('.needs-validation');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const confirmFeedback = document.getElementById('confirmPasswordFeedback');

        form.addEventListener('submit', function (event) {
            if (password.value !== confirmPassword.value) {
                confirmPassword.classList.add('is-invalid');
                confirmFeedback.style.display = 'block';
                event.preventDefault();
                event.stopPropagation();
            } else {
                confirmPassword.classList.remove('is-invalid');
                confirmFeedback.style.display = 'none';
            }

            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }

            form.classList.add('was-validated');
        }, false);
    });
</script>
